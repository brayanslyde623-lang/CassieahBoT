import os from "os";

interface PingContext {
  api: any;
  event: any;
}

export default {
  config: {
    name: "ping",
    aliases: ["pong", "status"],
    version: "3.3.0",
    author: "Brayan stack's",
    description: "Ping + uptime (jours) avec auto-suppression",
    category: "system",
    cooldowns: 3
  },

  onStart: async function ({ api, event }: PingContext): Promise<void> {
    const start: number = Date.now();

    // Message temporaire
    api.sendMessage("âš¡ Analyse en cours...", event.threadID, (err: any, info: any) => {
      if (err) return;

      const ping: number = Date.now() - start;

      // â± UPTIME avec jours
      const uptime: number = process.uptime();
      const days: number = Math.floor(uptime / 86400);
      const hours: number = Math.floor((uptime % 86400) / 3600);
      const minutes: number = Math.floor((uptime % 3600) / 60);
      const seconds: number = Math.floor(uptime % 60);

      const usedMem: string = (process.memoryUsage().rss / 1024 / 1024).toFixed(1);
      const totalMem: string = (os.totalmem() / 1024 / 1024 / 1024).toFixed(1);
      const cpu: string = os.cpus()[0].model.split("@")[0];

      const result: string = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        ðŸ¤– BOT STATUS        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âš¡ Ping       : ${ping} ms
â•‘ â± Uptime     : ${days}j ${hours}h ${minutes}m ${seconds}s
â•‘ ðŸ’¾ RAM        : ${usedMem} MB / ${totalMem} GB
â•‘ ðŸ§  CPU        : ${cpu}
â•‘ ðŸ›  Version    : v3.3.0
â•‘ ðŸŸ¢ Statut     : En ligne ðŸ©·
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      `;

      // Supprimer "Analyse en cours..."
      api.unsendMessage(info.messageID);

      // Envoyer le rÃ©sultat puis supprimer aprÃ¨s 20s
      api.sendMessage(result, event.threadID, (err2: any, finalMsg: any) => {
        if (err2) return;

        setTimeout(() => {
          api.unsendMessage(finalMsg.messageID);
        }, 20000);
      });
    });
  }
};